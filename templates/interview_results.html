{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/results.css') }}">
{% endblock %}

{% block content %}
<section class="evaluation-header">
    <h1>Interview Performance Results</h1>
    <div class="evaluation-summary">
        <div class="total-score">
            <span class="score-value">{{ evaluation.scores.total }}/100</span>
            <span class="grade">{{ evaluation.formatted.letter_grade }}</span>
        </div>
        <div class="prompt-container">
            <h3>Question:</h3>
            <p class="prompt-text">"{{ question }}"</p>
        </div>
    </div>
</section>

<section class="score-breakdown">
    <h2>Performance Metrics</h2>
    <div class="score-grid">
        {% set formatted = evaluation.formatted %}
        {% for cat_key, cat_data in modes.interview.categories.items() %}
        <div class="score-card">
            <h3>{{ cat_data.name }}</h3>
            <div class="score-display">
                <div class="score">
                    {{ evaluation.scores[cat_key] }}/{{ cat_data.max_score }}
                </div>
                <div class="percentage">{{ formatted[cat_key + '_pct'] }}%</div>
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {{ formatted[cat_key + '_pct'] }}%"></div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<section class="detailed-feedback">
    <h2>Detailed Analysis</h2>
    {% for cat_key, cat_data in modes.interview.categories.items() %}
    <div class="feedback-category">
        <h3>{{ cat_data.name }} ({{ evaluation.scores[cat_key] }}/{{ cat_data.max_score }})</h3>
        <div class="feedback-section">
            <h4>Strengths</h4>
            <ul>
                {% for point in evaluation.feedback[cat_key].strengths %}
                <li>{{ point }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="feedback-section">
            <h4>Improvements</h4>
            <ul>
                {% for point in evaluation.feedback[cat_key].improvements %}
                <li>{{ point }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endfor %}
</section>

{% if evaluation.sample_improved_answer %}
<section class="evaluation-summary"
    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px;">
    <h2 style="color: white; margin-top: 0;">üí° Sample Improved Answer</h2>
    <div class="summary-box"
        style="background: rgba(255,255,255,0.95); color: #333; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ffd700;">
        <p style="font-style: italic; line-height: 1.6; margin: 0;">{{ evaluation.sample_improved_answer }}</p>
    </div>
    <p style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.9;">
        ‚ÑπÔ∏è This is an AI-generated example showing how you could structure your answer more effectively.
    </p>
</section>
{% endif %}

<section class="evaluation-summary">
    <h2>Coach's Summary</h2>
    <div class="summary-box">
        <p>{{ evaluation.summary }}</p>
    </div>
</section>

<section class="essay-text">
    <h2>Your Answer</h2>
    <div class="essay-container">
        <pre style="white-space: pre-wrap; font-family: inherit;">{{ answer }}</pre>
    </div>
</section>

<div class="action-buttons">
    <a href="/interview" class="btn btn-primary">Try Another Question</a>
    <a href="/history" class="btn btn-secondary">View History</a>
</div>
{% endblock %}